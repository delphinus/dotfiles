#!/bin/bash -eu
name=${1:-}
if [[ -z $name ]]; then
  echo 'set name' 2>&1
  exit 1
fi
git_url="$(git remote -v | grep origin | head -1 | cut -f2 | cut -d' ' -f1)"
if [[ $git_url =~ ^(http|git|ssh):// ]]; then
  url="$(echo "$git_url" | \
    NAME="$name" perl -F/ -ape '$F[3] = $ENV{NAME}; $_ = join "/", @F')"
elif [[ $git_url =~ ^git@ ]]; then
  url="$(echo "$git_url" | \
    NAME="$name" perl -pe '($host, $repo) = (split m|[:/@]|)[1, 3]; $_ = "https://$host/$ENV{NAME}/$repo"')"
else
  echo "failed to parse url: $git_url" 2>&1
  exit 1
fi
if [[ -z $url ]]; then
  echo "failed to set url for $name" 2>&1
  exit 1
fi
git remote add "$name" "$url"
git fetch "$name"
echo
echo "added $name remote setting successfully"
