scriptencoding utf-8

" ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã¾ãªã„
set guioptions+=M

let g:is_mac = has('macunix')
let g:is_remora_cx = hostname() == 'remora'
let g:is_remora = hostname() =~ '^remora'
let g:is_remora_office = hostname() == 'remora-office'
let g:is_backup = hostname() == 'backup.remora.cx'
let g:is_office = hostname() !~ 'remora' && len($H) > 0 && has('unix')
let g:is_office_win = len($USERDOMAIN) && has('win32')
let g:is_office_cygwin = len($USERDOMAIN) && has('win32unix')
let g:is_office_alt = is_office && $VIM_ENV_ALT
let g:is_xerxes = hostname() == 'xerxes'
let g:is_remora_air2_win = hostname() == 'remora-air2-win'
let g:is_unix = is_mac || is_remora || is_backup || is_office || is_office_cygwin
let g:is_win = is_office_win || is_xerxes || is_remora_air2_win

if is_mac || is_remora || is_office_cygwin || is_backup
    let g:home = expand('~')
elseif is_office
    let g:home = expand('$H')
elseif is_win
    let g:home = expand('$HOME')
else
    finish
endif

let g:vim_home = g:home . '/.vim'

" ã‚·ã‚§ãƒ«ã®ä½ç½®ã‚’å…ƒã«æˆ»ã™
if is_office
    set shell=/bin/sh
elseif is_office_win
    set shell=$SYSTEMROOT\system32\cmd.exe
endif

" NeoBundle è¨­å®šé–‹å§‹

" ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¿å­˜ãƒ‘ã‚¹
let g:bundle_dir = g:home . '/.vim/bundle'
let g:neobundle_dir = g:bundle_dir . '/neobundle.vim'
let g:after_dir = g:home . '/.vim/after'

" ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒˆã‚³ãƒ«
let g:neobundle#types#git#default_protocol=g:is_office ? 'ssh' : 'https'

" NeoBundle ã¸ã®ãƒ‘ã‚¹
if has('vim_starting')
    set nocompatible               " Be iMproved

    if is_office
        set runtimepath-=$HOME/.vim
    endif
    execute 'set runtimepath+=' . g:neobundle_dir . '/,' . g:after_dir . '/'
endif

" Required:
call neobundle#begin(expand(g:bundle_dir))

" Let NeoBundle manage NeoBundle
" Required:
NeoBundleFetch 'Shougo/neobundle.vim'

" Set vimproc
NeoBundle 'Shougo/vimproc.vim', {'build': {
    \   'cygwin': 'make -f make_cygwin.mak',
    \   'mac': 'make -f make_mac.mak',
    \   'unix': 'make -f make_unix.mak',
    \   },
    \ }

NeoBundle 'rkitover/vimpager'

NeoBundle 'airblade/vim-rooter'
NeoBundle 'blueyed/vim-colors-solarized'
NeoBundle 'houtsnip/vim-emacscommandline'
NeoBundle 'majutsushi/tagbar'
NeoBundle 'morhetz/gruvbox'
NeoBundle 'tpope/vim-fugitive'

if has('vim_starting')
    if is_win
        set runtimepath+=~/vimfiles/
    elseif is_mac || is_remora || is_office_cygwin
        set runtimepath+=~/.vim/
    elseif is_office
        set runtimepath^=$H/.vim/
    endif
endif

call neobundle#end()

filetype plugin indent on
syntax on

let mapleader='`'

colorscheme solarized
set t_ut=
set background=dark

nnoremap <C-D> 3<C-D>
nnoremap <C-U> 3<C-U>
nmap <ESC><ESC> ;nohlsearch<CR><ESC>

set t_Co=256
set encoding=utf-8
set termencoding=utf-8
set hlsearch
" ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
if ! (has('gui_macvim') && has('kaoriya'))
  set fileencodings=ucs-bom,utf-8,eucjp,cp932,ucs-2le,latin1,iso-2022-jp
endif
set dir=/tmp
if is_office
    set backupdir=$H/tmp
    set undodir=$H/tmp
else
    set backupdir=/tmp
    set undodir=/tmp
endif
set ttymouse=sgr
set mouse=a
set display=uhex
set cursorline
set clipboard=autoselectml
set grepprg=ack
set diffopt=filler,vertical,iwhite
set synmaxcol=0
set title
set titleold=bash
set titlestring=%t%(\ %M%)%(\ (%{expand(\"%:~:.:h\")})%)%(\ %a%)
set ambiwidth=single
set list                 " ç©ºç™½ã®å¯è¦–åŒ–
if has('macunix')
  set listchars=tab:â–¸\ ,trail:â£,eol:â—‚,extends:Â»,precedes:Â«,nbsp:Â¯
else
  set listchars=tab:â€¦\ ,trail:â€¦,eol:ğŸ”»,extends:Â»,precedes:Â«,nbsp:Â¯
endif
set tabstop=2       " ç”»é¢ä¸Šã§ã‚¿ãƒ–æ–‡å­—ãŒå ã‚ã‚‹å¹…
set softtabstop=2   " ã‚¿ãƒ–ã‚­ãƒ¼ã‚„ãƒãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ã‚«ãƒ¼ã‚½ãƒ«ãŒå‹•ãå¹…
set shiftwidth=2    " è‡ªå‹•ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚„ <<, >> ã§ãšã‚Œã‚‹å¹…
set laststatus=0


"-----------------------------------------------------------------------------
" ãƒ˜ãƒ«ãƒ—
function! s:VertHelp(word)
  exec 'vertical help ' . a:word
  exec 'vertical resize 80'
  exec 'setl wfw'
endfunction
command! -nargs=? H call s:VertHelp(<f-args>)
autocmd FileType help nnoremap <buffer>q :q<CR>

"-----------------------------------------------------------------------------
" Teamplte::Toolkit è¨­å®š
au BufNewFile,BufRead *.tt2 setf tt2html
au BufNewFile,BufRead *.tt setf tt2html

"-----------------------------------------------------------------------------
" pentadactylrc è¨­å®š
au BufNewFile,BufRead .pentadactylrc setf pentadactyl

"-----------------------------------------------------------------------------
" yank to remote clipboard
if is_unix
    let s:tmpdir = &backupdir
    let s:home = is_office ? expand('$H') : expand('$HOME')
    let g:y2r_config = {
    \    'tmp_file': s:tmpdir . '/exchange-file',
    \    'key_file' : s:home . '/.exchange.key',
    \    'host' : 'localhost',
    \    'port' : 52224,
    \}

    function! Yank2Remote()
        call writefile(split(@", '\n'), g:y2r_config.tmp_file, 'b')
        let s:params = ['cat %s %s | nc -w1 %s %s']
        for s:item in ['key_file', 'tmp_file', 'host', 'port']
        let s:params += [shellescape(g:y2r_config[s:item])]
        endfor
        let s:ret = system(call(function('printf'), s:params))
        echo 'paste to remote'
    endfunction
    nnoremap <silent> <unique> <Leader>y :call Yank2Remote()<CR>
endif

"-----------------------------------------------------------------------------
" vimpager
let g:vimpager_passthrough = 1

if exists("vimpager")
    if exists("vimpager_ptree") && vimpager_ptree[-2] == 'wman'
        set ft=man
    endif
endif

" ã‚ªãƒ•ã‚£ã‚¹å°‚ç”¨è¨­å®š
let g:office_vimrc = g:home . '/git/dotfiles-office/.vimrc'
if (is_remora_office || is_office) && filereadable(g:office_vimrc)
    execute 'source ' . g:office_vimrc
endif

" vim:ft=vim et:
